
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: webfounder-app
    ports:
      - "8080:8080"
    environment:
      # RDS 데이터베이스 설정
      SPRING_DATASOURCE_URL: jdbc:mysql://webfounders3-be.cluiswqyo2vx.ap-northeast-2.rds.amazonaws.com:3306/webfounder?serverTimezone=Asia/Seoul&useSSL=true&requireSSL=true
      SPRING_DATASOURCE_USERNAME: admin
      SPRING_DATASOURCE_PASSWORD: Tnrajttk12rl!
      SPRING_DATASOURCE_DRIVER_CLASS_NAME: com.mysql.cj.jdbc.Driver
      
      # JPA 설정
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
      SPRING_JPA_SHOW_SQL: "true"
      SPRING_JPA_DATABASE_PLATFORM: org.hibernate.dialect.MySQL8Dialect
      
      # 메일 설정
      SPRING_MAIL_HOST: smtp.gmail.com
      SPRING_MAIL_PORT: 587
      SPRING_MAIL_USERNAME: sookmyung@likelion.org
      SPRING_MAIL_PASSWORD: ${MAIL_PASSWORD}
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_AUTH: "true"
      SPRING_MAIL_PROPERTIES_MAIL_SMTP_STARTTLS_ENABLE: "true"

      # AWS S3
      AWS_S3_BUCKET: ${AWS_S3_BUCKET}
      AWS_S3_REGION: ${AWS_S3_REGION}
      AWS_S3_ACCESS_KEY: ${AWS_S3_ACCESS_KEY}
      AWS_S3_SECRET_KEY: ${AWS_S3_SECRET_KEY}
      
      # Google Docs API 설정
      GOOGLE_DOCS_DOCUMENT_ID: ${GOOGLE_DOCS_ID}
      
      # JWT 설정
      JWT_SECRET: ${JWT_SECRET}
      
      # Spring 프로파일
      SPRING_PROFILES_ACTIVE: prod

    env_file:
      - .env
    volumes:
      - ./logs:/var/log
      - ./credentials.json:/app/credentials.json:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
